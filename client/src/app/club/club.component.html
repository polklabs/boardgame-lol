<app-menu-bar
  page="club"
  (newGame)="newGame()"
  (newBoardGame)="newBoardGame()"
  (newPlayer)="newPlayer()"></app-menu-bar>

<app-editor-game
  *ngIf="editorGameVisible"
  [editorVisible]="editorGameVisible"
  [game]="editGame"
  (closeEditor)="editorGameVisible = false"></app-editor-game>

<app-editor-board-game
  *ngIf="editorBoardGameVisible"
  [editorVisible]="editorBoardGameVisible"
  [boardGame]="editBoardGame"
  (closeEditor)="editorBoardGameVisible = false"></app-editor-board-game>

<app-editor-player
  *ngIf="editorPlayerVisible"
  [editorVisible]="editorPlayerVisible"
  [player]="editPlayer"
  (closeEditor)="editorPlayerVisible = false"></app-editor-player>

<h1>Board Games</h1>
<p-table [value]="(boardGames$ | async) ?? []" sortField="Name" [sortOrder]="1" [tableStyle]="{ 'min-width': '50rem' }">
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="Name">
        Game
        <p-sortIcon field="Name" />
      </th>
      <th>Times Played</th>
      <th>Champion(s)</th>
      <th>Most Players Per Game</th>
      <th>Average Players Per Game</th>
      <th>Highest Score</th>
      <th>Average Score</th>
      <th>Average Winning Score</th>
      <th *ngIf="canEdit">Edit</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-boardGame>
    <tr>
      <td>{{ boardGame.Name }}</td>
      <td>{{ boardGame.Games.length | number:'1.0-0' }}</td>
      <td>{{ boardGame.Champions | array:'Name' }}</td>
      <td>{{ boardGame.MaxPlayers | number:'1.0-0' }}</td>
      <td>{{ boardGame.AveragePlayers | number:'1.0-3' }}</td>
      <td>{{ boardGame.MaxScore | number:'1.0-3' }}</td>
      <td>{{ boardGame.AverageScore | number:'1.0-3' }}</td>
      <td>{{ boardGame.AverageWinningScore | number:'1.0-3' }}</td>
      <td *ngIf="canEdit">
        <p-button (click)="boardGameEdit(boardGame)" icon="pi pi-pencil" [rounded]="true" [text]="true"></p-button>
      </td>
    </tr>
  </ng-template>
</p-table>

<h1>Players</h1>
<p-table [value]="(players$ | async) ?? []" sortField="Name" [sortOrder]="1" [tableStyle]="{ 'min-width': '50rem' }">
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="Name">
        Name
        <p-sortIcon field="Name" />
      </th>
      <th>Wins</th>
      <th>Best Game(s)</th>
      <th>Best Game(s) Wins</th>
      <th *ngIf="canEdit">Edit</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-player>
    <tr>
      <td>{{ player.Name }}</td>
      <td>{{ player.Wins.length | number:'1.0-0' }}</td>
      <td>{{ player.BestGames | array:'Name' }}</td>
      <td>{{ player.BestGameWins | number:'1.0-0' }}</td>
      <td *ngIf="canEdit">
        <p-button (click)="playerEdit(player)" icon="pi pi-pencil" [rounded]="true" [text]="true"></p-button>
      </td>
    </tr>
  </ng-template>
</p-table>

<h1>Games</h1>
<p-table [value]="(games$ | async) ?? []" sortField="Date" [sortOrder]="1" [tableStyle]="{ 'min-width': '50rem' }">
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="Date">
        Date
        <p-sortIcon field="Date" />
      </th>
      <th>Game</th>
      <th>Players</th>
      <th>Winner(s)</th>
      <th>Points</th>
      <th>Did Not Finish</th>
      <th *ngIf="canEdit">Edit</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-game>
    <tr>
      <td>{{ game.Date | date: 'fullDate' }}</td>
      <td>{{ game.BoardGame.Name }}</td>
      <td>{{ game.Players | number:'1.0-0' }}</td>
      <td>{{ game.Scores | array:'Player.Name' }}</td>
      <td>{{ game.Scores[0]?.Points | number:'1.0-3' }}</td>
      <td>{{ game.DidNotFinish }}</td>
      <td *ngIf="canEdit">
        <p-button (click)="gameEdit(game)" icon="pi pi-pencil" [rounded]="true" [text]="true"></p-button>
      </td>
    </tr>
  </ng-template>
</p-table>
